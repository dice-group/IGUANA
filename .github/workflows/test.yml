name: Workflow Test

on:
  push:
    branches:
      - feature/ahead-of-time-compiler

jobs:
  compile_jar:
    name: Compile Jar executable
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'adopt'
          cache: 'maven'
      - name: 'Compile jar'
        run: 'mvn -DskipTests package'
      - name: 'Upload artifact'
        uses: actions/upload-artifact@v4
        with:
          name: 'iguana-jar'
          path: 'target/iguana-*.jar'


  compile_native:
    name: Compile Native executable
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up GraalVM
        uses: graalvm/setup-graalvm@v1
        with:
          java-version: '21'
          cache: 'maven'
      - name: 'Generate configuration files'
        run: './graalvm/generate-config.sh'
      - name: 'Compile native-binary'
        run: 'mvn -DskipTests package -Pnative'
      - name: 'Upload artifact'
        uses: actions/upload-artifact@v4
        with:
          name: 'iguana-jar'
          path: 'target/iguana-*.*.*'

